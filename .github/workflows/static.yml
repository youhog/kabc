# Simple workflow for deploying static content to GitHub Pages
name: ç¶²é æ›´æ–°

on:
  # åªå…è¨±æ‚¨å¾ Actions é ç±¤æ‰‹å‹•é‹è¡Œæ­¤å·¥ä½œæµç¨‹
  workflow_dispatch:

  # âœ… ç•¶ç‰¹å®šæª”æ¡ˆæœ‰è®Šå‹•æ™‚è‡ªå‹•è§¸ç™¼
  push:
    branches:
      - youzih/dev/*
      - Youzih/dev/*
    paths:
      - 'data/portfolio-data.json'  # ç›£è½è³‡æ–™æª”è®Šæ›´
      - '.github/workflows/deploy.yml'  # ï¼ˆå¯é¸ï¼‰è‹¥ä½ æ›´æ–°å·¥ä½œæµç¨‹ä¹Ÿé‡æ–°éƒ¨ç½²
      - '.github/workflows/static.yml'

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Single deploy job since we're just deploying
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: æª¢æŸ¥
        uses: actions/checkout@v4
      
      # 1. æ³¨å…¥é…ç½®è®Šæ•¸ (æ•´åˆé€²æ–° Workflow)
      - name: æ³¨å…¥é…ç½®è®Šæ•¸
        run: |
          # ğŸš¨ è­¦å‘Š: é€™è£¡çš„ sed å‘½ä»¤å°‡æœƒä½¿ç”¨æ‚¨çš„ Secrets å€¼æ›¿æ› index.html å…§çš„ä½”ä½ç¬¦ã€‚
          # ----------------------------------------------------------------------
          # æ›¿æ› GITHUB_CONFIG å…§çš„ç”¨æˆ¶åå’Œå€‰åº«å (ä½¿ç”¨æ–°çš„ Secret åç¨±)
          sed -i "s|'youhog'        // ğŸ”§ æ›¿æ›æˆä½ çš„ GitHub ç”¨æˆ¶å|'${{ secrets.REPO_OWNER_USERNAME }}'|g" index.html
          sed -i "s|'kabc'          // ğŸ”§ æ›¿æ›æˆä½ çš„å€‰åº«åç¨±|'${{ secrets.REPO_NAME }}'|g" index.html
          
          # æ›¿æ› Secrets æ³¨å…¥é» (ç”¨æ–¼è‡ªå‹•è§£é– Token)
          # æ³¨æ„ï¼šé€™è£¡æœƒå°‡ Secrets å€¼è½‰æ›ç‚º JS å­—ç¬¦ä¸² (ç”¨å–®å¼•è™Ÿæ‹¬èµ·ä¾†)
          sed -i "s|// è¨»è§£ï¼šAUTH_TOKEN_SECRET|const AUTH_TOKEN_SECRET = '${{ secrets.AUTH_TOKEN_SECRET }}';|g" index.html
          sed -i "s|// è¨»è§£ï¼šAUTH_PASSWORD_SECRET|const AUTH_PASSWORD_SECRET = '${{ secrets.AUTH_PASSWORD_SECRET }}';|g" index.html
          # ----------------------------------------------------------------------

      - name: è¨­å®šé é¢
        uses: actions/configure-pages@v5
      - name: ä¸Šå‚³
        uses: actions/upload-pages-artifact@v3
        with:
          # ä¸Šå‚³æ•´å€‹å„²å­˜åº«ä½œç‚ºéœæ…‹å…§å®¹
          path: '.'
      - name: æ›´æ–°
        id: deployment
        uses: actions/deploy-pages@v4
